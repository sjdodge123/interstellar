<html>
<canvas id ="gameCanvas" width = "800" height = "600"></canvas>

<script src="spaceObjects.js"></script>
<script src="polyDraw.js"></script>
<script src="spacePhysics.js"></script>
<script type="text/javascript">
"use strict";
var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
	height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight,

	canvas = document.getElementById('gameCanvas');
	canvas.width = width-50;
	canvas.height = height-50;


var ctx,
mouseX,
mouseY,
gameObjectList = [],
ship,
cannon,
assTard,
asteroidSpawn,
game;


// **************************	MAIN    **************************
function update() {
	clearBackground();
	for(var i = 0; i < gameObjectList.length;i+=1){
		gameObjectList[i].update();
	}
}

function spawnAsteroid(evt) {
	assTard = new Asteroid(Math.random() * canvas.width, Math.random() * canvas.height,0,0,0,'white');
	gameObjectList.push(assTard);
}

window.onload = function() {
	var framesPerSecond = 1000/30;
	ctx = canvas.getContext('2d');
	ship = new ShipObject(canvas.width/2,canvas.height/2,10,30,0,'white',20);
	cannon = new Cannon(canvas.width/2,canvas.height/2,5,15,0,'red');
	ship.weapon = cannon;
	gameObjectList.push(ship);
	gameObjectList.push(ship.weapon);
	game = setInterval(update,framesPerSecond);
	asteroidSpawn = setInterval(spawnAsteroid,1000);
	canvas.addEventListener("mousemove", calcMousePos, false);
	canvas.addEventListener("click", handleClick, false);
	window.addEventListener("keydown", handleKeys, false);
}

// **************************	Event Handlers    **************************
function calcMousePos(evt){
	evt.preventDefault();
	var rect = canvas.getBoundingClientRect(),
		root = document.documentElement;
	mouseX = evt.pageX - rect.left - root.scrollLeft;
	mouseY = evt.pageY - rect.top - root.scrollTop;
}

function handleClick(evt){
	evt.preventDefault();
}

function handleKeys(evt){
	var moveFoward = false;
	var moveBackward = false;
	var turnLeft = false;
	var turnRight = false;

	switch(evt.keyCode) {
	    case 65: {turnLeft = true; break;} //Left key
        case 87: {moveFoward = true; break;} //Up key
        case 68: {turnRight = true; break;}//Right key
        case 83: {moveBackward = true; break;} //Down key
	}
    if(moveFoward){
    	ship.accelY -= Math.cos((Math.PI*ship.angle)/180) * ship.speed; 
    	ship.accelX += Math.sin((Math.PI*ship.angle)/180) * ship.speed; 
    }
    if(moveBackward){
    	ship.accelY += Math.cos((Math.PI*ship.angle)/180) * ship.speed; 
    	ship.accelX -= Math.sin((Math.PI*ship.angle)/180) * ship.speed;
    }
    if(turnLeft){
    	ship.angle -= ship.turnSpeed;
    }
    if(turnRight){
    	ship.angle += ship.turnSpeed;
    }
}


// **************************	DRAWING   **************************

function clearBackground() {
	ctx.clearRect(0,0,canvas.width,canvas.height);
	ctx.fillStyle = 'black';
	ctx.fillRect(0,0,canvas.width,canvas.height);
}

</script>
</html>